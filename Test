var OPENAI_API_KEY="",bTextToSpeechSupported=!1,bSpeechInProgress=!1,oSpeechRecognizer=null,oSpeechSynthesisUtterance=null,oVoices=null;function OnLoad(){"webkitSpeechRecognition"in window||(lblSpeak.style.display="none"),"speechSynthesis"in window&&(bTextToSpeechSupported=!0,speechSynthesis.onvoiceschanged=function(){oVoices=window.speechSynthesis.getVoices();for(var e=0;e<oVoices.length;e++)selVoices[selVoices.length]=new Option(oVoices[e].name,e)})}function ChangeLang(e){oSpeechRecognizer&&(oSpeechRecognizer.lang=selLang.value)}function Send(){var e=txtMsg.value;if(""==e)return alert("Type in your question!"),void txtMsg.focus();spMsg.innerHTML="Chat GPT is thinking...";var t="https://api.openai.com/v1/completions",n=selModel.value;-1!=n.indexOf("gpt-3.5-turbo")&&(t="https://api.openai.com/v1/chat/completions");var o=new XMLHttpRequest;o.open("POST",t),o.setRequestHeader("Accept","application/json"),o.setRequestHeader("Content-Type","application/json"),o.setRequestHeader("Authorization","Bearer "+OPENAI_API_KEY),o.onreadystatechange=function(){if(4===o.readyState){spMsg.innerHTML="";var e={};""!=txtOutput.value&&(txtOutput.value+="\n");try{e=JSON.parse(o.responseText)}catch(e){txtOutput.value+="Error: "+e.message}if(e.error&&e.error.message)txtOutput.value+="Error: "+e.error.message;else if(e.choices){var t="";if(e.choices[0].text?t=e.choices[0].text:e.choices[0].message&&(t=e.choices[0].message.content),"en-US"!=selLang.value){var n=t.split("?\n");2==n.length&&(t=n[1])}""==t?t="No response":(txtOutput.value+="Chat GPT: "+t,TextToSpeech(t))}}};var s={model:n,prompt:e,max_tokens:2048,user:"1",temperature:.5,frequency_penalty:0,presence_penalty:0,stop:["#",";"]};-1!=n.indexOf("gpt-3.5-turbo")&&(s={model:n,messages:[{role:"user",content:e}]}),o.send(JSON.stringify(s)),""!=txtOutput.value&&(txtOutput.value+="\n"),txtOutput.value+="Me: "+e,txtMsg.value=""}function TextToSpeech(e){if(0!=bTextToSpeechSupported&&!chkMute.checked){if(oSpeechSynthesisUtterance=new SpeechSynthesisUtterance,oVoices){var t=selVoices.value;""!=t&&(oSpeechSynthesisUtterance.voice=oVoices[parseInt(t)])}oSpeechSynthesisUtterance.onend=function(){oSpeechRecognizer&&chkSpeak.checked&&oSpeechRecognizer.start()},oSpeechRecognizer&&chkSpeak.checked&&oSpeechRecognizer.stop(),oSpeechSynthesisUtterance.lang=selLang.value,oSpeechSynthesisUtterance.text=e,window.speechSynthesis.speak(oSpeechSynthesisUtterance)}}function Mute(e){selVoices.style.display=e?"none":""}function SpeechToText(){oSpeechRecognizer?chkSpeak.checked?oSpeechRecognizer.start():oSpeechRecognizer.stop():((oSpeechRecognizer=new webkitSpeechRecognition).continuous=!0,oSpeechRecognizer.interimResults=!0,oSpeechRecognizer.lang=selLang.value,oSpeechRecognizer.start(),oSpeechRecognizer.onresult=function(e){for(var t="",n=e.resultIndex;n<e.results.length;n++){var o=e.results[n][0].transcript;e.results[n].isFinal?(txtMsg.value=o,Send()):(o.replace("\n","<br>"),t+=o),document.getElementById("idText").innerHTML='<span style="color: #999;">'+t+"</span>"}},oSpeechRecognizer.onerror=function(e){})}
